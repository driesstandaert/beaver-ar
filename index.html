<!DOCTYPE html>
<html>
    <script src="https://aframe.io/releases/1.0.0/aframe.min.js"></script>
    <!-- we import arjs version without NFT but with marker + location based support -->
    <!-- <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script> -->

    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>

    <link rel="stylesheet" type="text/css" href="./style.css"/>
    <script type="text/javascript">
        // Create shadow on transparent <a-plane>
        AFRAME.registerComponent('shadow-material', {
          init() {
              this.material = new THREE.ShadowMaterial();
              this.el.getOrCreateObject3D('mesh').material = this.material;
              this.material.opacity = 0.3;
          }
        });

        // Show loading box before model is loaded
        // AFRAME.registerComponent('box-loader', {
        //     init: function() {
        //         this.el.addEventListener('model-loaded', e => {
        //             document.querySelector("#loadingEl").remove()
        //         })
        //     }
        // })

        window.onload=function(){
                var sceneEl = document.querySelector('a-scene');
                var entity = sceneEl.querySelector('a-entity');
               
                document.querySelector('.js-button').addEventListener('click', function () {
                    console.log('click');

                    if (entity.hasAttribute('animation')) {
                        entity.emit('rotate');
                    } else {
                        entity.setAttribute('animation', 'property: rotation; from: 0 0 0; to: 0 360 0; loop: 1; dur: 2000; easing:linear; startEvents: rotate;')
                        entity.emit('rotate');
                    }
                });

                entity.addEventListener('animationcomplete', function(){ 
                    this.removeAttribute('animation');
                    this.flushToDOM() // Update the DOM
                });
            }
    </script>

    <body style="margin : 0px; overflow: hidden;">
        <a-scene 
          vr-mode-ui='enabled: false' 
          embedded 
          arjs='sourceType: webcam; debugUIEnabled: false; patternRatio: 0.5;'
          renderer="antialias: true; logarithmicDepthBuffer: true; colorManagement: true; sortObjects: true;"
          loading-screen="dotsColor: red; backgroundColor: black"
        >

        <a-assets>
            <a-asset-item id="trout" src="./assets/trout/scene.gltf"></a-asset-item>
            <!-- <a-asset-item id="crocodile" src="./assets/crocodile/scene.gltf"></a-asset-item> -->
        </a-assets>

        <!-- Trout -->
        <a-marker preset='custom' type='pattern' url='marker-qr.patt'>
            <a-entity
            position="0 0 0"
            rotation="0 0 0"
            scale="1 1 1"
            gltf-model="#trout"
            shadow="receive: true"
            animation="property: rotation; to: 0 360 0; loop: 1; dur: 2000; easing:linear; startEvents: rotate;"
            animation-mixer
            box-loader
            >
            </a-entity>
            </a-entity>
            <a-plane height="100" width="100" rotation="-90 0 0" shadow="receive: true" shadow-material></a-plane>
        </a-marker>


        <!-- Crododile -->
        <!-- <a-marker preset="hiro">
            <a-box id='loadingEl' color="red" depth="0.1" height="0.1" width="0.1" animation="property: rotation; to: 0 360 0; loop: true; dur: 1000" ></a-box>
            <a-entity
            position="0 1 0"
            rotation="0 45 0"
            scale="0.5 0.5 0.5"
            gltf-model="#crocodile"
            shadow="receive: true"
            animation-mixer
            loading-box
            >
            </a-entity>
            <a-plane height="100" width="100" rotation="-90 0 0" shadow="receive: true" shadow-material></a-plane>
        </a-marker> -->

        <a-entity camera></a-entity>

        </a-scene>

        <div class="c-controls">
            <button data-action="change" class="js-button"></button>
        </div>
    </body>
</html>